<!DOCTYPE html>
<html>
<head>
    <title>Canvas å°çƒç‰©ç†æ¨¡æ“¬</title>
    <style>
        body {
            background: #000;
        }
        * {
            font-family: "Comic Sans MS", æ¨™æ¥·é«”;
            color: white; /* è®“æ–‡å­—åœ¨é»‘åº•ä¸Šå¯è¦‹ */
        }
        #cvs {
            /* å»ºè­°åŠ ä¸Š width: 500px; è®“ç•«å¸ƒæ¯”ä¾‹æ­£ç¢º */
            height: 500px; 
            width: 500px; 
        }
        #wl {
            display: flex;
            align-items: flex-start;
            margin: 20px;
        }
        /* æ»¾å‹•æ¢æ¨£å¼ (ä¿æŒä¸è®Š) */
        ::-webkit-scrollbar-corner {
            background: #181818;
        }
        ::-webkit-scrollbar-track {
            -webkit-box-shadow: inset 0 0 6px rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            background-color: #303030;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #6c6c6c;
        }
        ::-webkit-scrollbar-thumb {
            background-color: #a1a1a1;
            border-radius: 10px;
        }
        ::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }
        ::-webkit-resizer {
            background: #828282;
            outline: 2px solid #b6b6b6;
        }
    </style>
</head>
<body>
    <div id="wl">
        <canvas id="cvs" width="1000" height="1000"></canvas>
        <div style="padding-left: 20px;">
            <p>å°çƒæ•¸é‡ï¼š<span id="ballCountDisplay">1</span></p>
            <input type="range" id="ipt">
            
            <p>å¼•åŠ›å¼·åº¦ï¼š<span id="strengthDisplay">0.005</span></p>
            <input type="range" id="strengthIpt">
            <p><strong>ğŸ’¡ æŒ‰ä¸‹æ»‘é¼ å·¦éµæ‰æœ‰å¼•åŠ›ï¼</strong></p>
        </div>
    </div>
    <script>
// ====== è¼”åŠ©å‡½æ•¸ (ä¿æŒä¸è®Š) ======
function $(el) {
    return document.querySelector(el);
}

function random(a, b) {
    return Math.floor(Math.random() * (b - a + 1)) + a;
}

function DegToRad(a) {
    return a * Math.PI / 180;
}

function HSLToRGB(h, s, l) {
    s /= 100;
    l /= 100;
    let c = (1 - Math.abs(2 * l - 1)) * s,
        x = c * (1 - Math.abs((h / 60) % 2 - 1)),
        m = l - c / 2,
        r = 0,
        g = 0,
        b = 0;
    if (0 <= h && h < 60) {
        r = c; g = x; b = 0;
    } else if (60 <= h && h < 120) {
        r = x; g = c; b = 0;
    } else if (120 <= h && h < 180) {
        r = 0; g = c; b = x;
    } else if (180 <= h && h < 240) {
        r = 0; g = x; b = c;
    } else if (240 <= h && h < 300) {
        r = x; g = 0; b = c;
    } else if (300 <= h && h < 360) {
        r = c; g = 0; b = x;
    }
    r = Math.round((r + m) * 255);
    g = Math.round((g + m) * 255);
    b = Math.round((b + m) * 255);

    return "rgb(" + r + "," + g + "," + b + ")";
}

// ====== è®Šæ•¸åˆå§‹åŒ– ======
var ipt = $("#ipt");
var cvs = $("#cvs");
var ctx = cvs.getContext("2d");
var ballCountDisplay = $("#ballCountDisplay");

// ğŸŒŸ æ–°å¢å¼•åŠ›æ»‘æ¡¿ DOM å…ƒç´ 
var strengthIpt = $("#strengthIpt");
var strengthDisplay = $("#strengthDisplay");


// éŠæˆ²ç‹€æ…‹èˆ‡ç‰©ç†åƒæ•¸
let balls = [];
let mouse = { x: 0, y: 0 };
let isMouseLeftDown = false; 

// ğŸŒŸ MOUSE_STRENGTH æ”¹ç‚º letï¼Œä»¥ä¾¿å¯ä»¥è¢«æ»‘æ¡¿ä¿®æ”¹
let MOUSE_STRENGTH = 0.005; 
const FRICTION = 0.999;
const MIN_SPEED = 0.1;       
const WALL_DAMPING = 0.95; 

// æ»‘æ¡¿è¨­å®š (å°çƒæ•¸é‡)
ipt.min = 1;
ipt.max = 30;
ipt.step = 1;
ipt.value = 1;

// ğŸŒŸ æ»‘æ¡¿è¨­å®š (å¼•åŠ›å¼·åº¦)
// ç”±æ–¼ MOUSE_STRENGTH æ•¸å€¼å¾ˆå°ï¼Œæˆ‘å€‘éœ€è¦ä¸€å€‹è½‰æ›æ©Ÿåˆ¶
const STRENGTH_FACTOR = 0.0001; // åŸºç¤å€æ•¸
strengthIpt.min = 1; // æœ€å° 0.0001 * 1 = 0.0001 (æ¥è¿‘é›¶å¼•åŠ›)
strengthIpt.max = 500; // æœ€å¤§ 0.0001 * 500 = 0.05 (è¼ƒå¼·å¼•åŠ›)
strengthIpt.step = 1;
// æ ¹æ“šç•¶å‰çš„ MOUSE_STRENGTH = 0.005ï¼Œè¨ˆç®—æ»‘æ¡¿åˆå§‹å€¼
strengthIpt.value = MOUSE_STRENGTH / STRENGTH_FACTOR;


// ====== Ball é¡åˆ¥ (ä¿æŒä¸è®Š) ======

class Ball {
    constructor(x, y, radius, color) {
        this.x = x;
        this.y = y;
        this.radius = radius;
        this.color = color;
        this.vx = (Math.random() - 0.5) * 15;
        this.vy = (Math.random() - 0.5) * 15;
        this.ax = 0;
        this.ay = 0;
        this.mass = radius / 10;
    }

    draw() {
        ctx.beginPath();
        ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
        ctx.fillStyle = this.color;
        ctx.fill();
        ctx.closePath();
    }

    // è™•ç†èˆ‡é‚Šç•Œ (ç‰†å£) çš„åå½ˆ (ä¿æŒä¸è®Š)
    handleWallCollision() {
        // å·¦å³ç‰†å£
        if (this.x + this.radius > cvs.width || this.x - this.radius < 0) {
            this.vx = -this.vx * WALL_DAMPING; 
            
            if (this.x - this.radius < 0) this.x = this.radius;
            if (this.x + this.radius > cvs.width) this.x = cvs.width - this.radius;

            if (this.x === this.radius && this.ax < 0) this.ax = 0;
            if (this.x === cvs.width - this.radius && this.ax > 0) this.ax = 0;
        }

        // ä¸Šä¸‹ç‰†å£
        if (this.y + this.radius > cvs.height || this.y - this.radius < 0) {
            this.vy = -this.vy * WALL_DAMPING;

            if (this.y - this.radius < 0) this.y = this.radius;
            if (this.y + this.radius > cvs.height) this.y = cvs.height - this.radius;

            if (this.y === this.radius && this.ay < 0) this.ay = 0;
            if (this.y === cvs.height - this.radius && this.ay > 0) this.ay = 0;
        }
    }

    // æ›´æ–°ä½ç½®ã€é€Ÿåº¦å’ŒåŠ é€Ÿåº¦ (æ ¸å¿ƒç‰©ç†è¨ˆç®—)
    update() {
        let current_ax = 0;
        let current_ay = 0;

        if (isMouseLeftDown) { 
            const dx = mouse.x - this.x;
            const dy = mouse.y - this.y;
            const distance = Math.sqrt(dx * dx + dy * dy); 
            
            // ğŸŒŸ ä½¿ç”¨ let MOUSE_STRENGTH
            const force = distance * MOUSE_STRENGTH; 

            current_ax = (dx / distance) * force / this.mass;
            current_ay = (dy / distance) * force / this.mass;
        } 
        
        this.ax = current_ax;
        this.ay = current_ay;

        this.handleWallCollision(); 

        this.vx += this.ax;
        this.vy += this.ay;
        
        this.vx *= FRICTION;
        this.vy *= FRICTION;

        if (Math.abs(this.vx) < MIN_SPEED) this.vx = 0;
        if (Math.abs(this.vy) < MIN_SPEED) this.vy = 0;

        this.x += this.vx;
        this.y += this.vy;
    }
}


// ====== éŠæˆ²ç¹ªåœ–èˆ‡å¾ªç’°å‡½æ•¸ (ä¿æŒä¸è®Š) ======

function bk() {
    ctx.clearRect(0, 0, cvs.width, cvs.height);
    ctx.save();
    ctx.fillStyle = "#181818";
    ctx.fillRect(0, 0, cvs.width, cvs.height);
    ctx.restore();
}

function draw() {
    let gdt = ctx.createLinearGradient(0, 0, cvs.width, cvs.height);
    gdt.addColorStop(1, "#f00");
    gdt.addColorStop(0, "#f0f");
    ctx.strokeStyle = gdt;
    ctx.lineWidth = 10;
    ctx.beginPath();
    ctx.moveTo(0, 0);
    ctx.lineTo(0, cvs.height);
    ctx.lineTo(cvs.width, cvs.height);
    ctx.lineTo(cvs.width, 0);
    ctx.lineTo(0, 0);
    ctx.stroke();
}

function dr() {
    bk();
    draw();

    for (let ball of balls) {
        ball.update();
        ball.draw();
    }
    requestAnimationFrame(dr);
}

// ====== äº‹ä»¶è™•ç†èˆ‡æ§åˆ¶ ======

// ğŸŒŸ æ–°å¢ï¼šå¼•åŠ›æ»‘æ¡¿äº‹ä»¶è™•ç†
strengthIpt.oninput = () => {
    // å°‡æ»‘æ¡¿å€¼è½‰æ›å›å¯¦éš›çš„ MOUSE_STRENGTH å€¼
    MOUSE_STRENGTH = parseFloat(strengthIpt.value) * STRENGTH_FACTOR;
    // é¡¯ç¤ºè½‰æ›å¾Œçš„æ•¸å€¼ï¼Œä¿ç•™å°æ•¸é»å¾Œ 5 ä½
    strengthDisplay.textContent = MOUSE_STRENGTH.toFixed(5);
};


// é¼ æ¨™ç§»å‹•æ™‚ï¼Œæ›´æ–°é¼ æ¨™åº§æ¨™ (ä¿æŒä¸è®Š)
cvs.addEventListener('mousemove', (e) => {
    const rect = cvs.getBoundingClientRect();
    const scaleX = cvs.width / rect.width;
    const scaleY = cvs.height / rect.height;

    mouse.x = (e.clientX - rect.left) * scaleX;
    mouse.y = (e.clientY - rect.top) * scaleY;
});

// é¼ æ¨™å·¦éµæŒ‰ä¸‹/é‡‹æ”¾ (ä¿æŒä¸è®Š)
cvs.addEventListener('mousedown', (e) => {
    if (e.button === 0) {
        isMouseLeftDown = true;
    }
});

cvs.addEventListener('mouseup', (e) => {
    if (e.button === 0) {
        isMouseLeftDown = false;
    }
});

// æ»‘æ¡¿è¼¸å…¥æ™‚ï¼šæ–°å¢æˆ–åˆªé™¤å°çƒ (ä¿æŒä¸è®Š)
ipt.oninput = () => {
    ballCountDisplay.textContent = ipt.value;
    createBalls(parseInt(ipt.value));
};

function createBalls(targetCount) {
    if (balls.length < targetCount) {
        const diff = targetCount - balls.length;
        for (let i = 0; i < diff; i++) {
            const radius = random(5, 20);
            const color = HSLToRGB(random(0, 360), 80, 50);
            const initialX = random(radius, cvs.width - radius);
            const initialY = random(radius, cvs.height - radius);
            balls.push(new Ball(initialX, initialY, radius, color));
        }
    } else if (balls.length > targetCount) {
        balls.splice(targetCount);
    }
}


// ====== å•Ÿå‹•ç¨‹å¼ ======

// é¦–æ¬¡åŠ è¼‰ï¼Œæ ¹æ“šæ»‘æ¡¿å€¼å‰µå»ºå°çƒ
createBalls(parseInt(ipt.value));
ballCountDisplay.textContent = ipt.value;
// ğŸŒŸ é¦–æ¬¡åŠ è¼‰ï¼Œæ›´æ–°å¼•åŠ›é¡¯ç¤ºå€¼
strengthDisplay.textContent = MOUSE_STRENGTH.toFixed(5);


// å•Ÿå‹•éŠæˆ²å¾ªç’°
requestAnimationFrame(dr);
    </script>
</body>
</html>