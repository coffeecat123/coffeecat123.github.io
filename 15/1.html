<html>
    <head>
        <meta charset="UTF-8">
        <title>cr</title>
        <style>
            input{
                height:5vh;
                width:5vw;
            }
            span{
                font-size:5vw;
                color:white;
            }
        </style>
    </head>
    <body style="background-color:rgb(0,0,0);">
        <input id="a1" type="color" oninput="az()">
        <input id="a2" type="color" oninput="az()">
        <input id="a3" type="color" oninput="az()">
        <input id="a4" type="color" oninput="az()"><br>
        <span>x:</span><input id="ax" style="width:50vw;" type="range" min="2" max="50" oninput="az()"><span id="ew1"></span><br>
        <span>y:</span><input id="ay" style="width:50vw;" type="range" min="2" max="50" oninput="az()"><span id="ew2"></span>
        <div id="qw"></div>
        <script>
            var a1=document.getElementById("a1");
            var a2=document.getElementById("a2");
            var a3=document.getElementById("a3");
            var a4=document.getElementById("a4");
            var ax=document.getElementById("ax");
            var ay=document.getElementById("ay");
            var ew1=document.querySelector("#ew1");
            var ew2=document.querySelector("#ew2");
            var qw = document.getElementById("qw");
            var x;
            var y;
            ax.value=5;
            ay.value=5;
            az();
            function az(){
                const x = parseInt(ax.value)+1;
                const y = parseInt(ay.value)+1;
                ew1.textContent = x-1;
                ew2.textContent = y-1;

                const c1 = getRGB(a1.value);
                const c2 = getRGB(a2.value);
                const c3 = getRGB(a3.value);
                const c4 = getRGB(a4.value);

                qw.innerHTML = "";

                for (let i = 0; i < y; i++) {
                    for (let j = 0; j < x; j++) {
                        const w = document.createElement("div");
                        
                        const r = lerp2D(c1.r, c2.r, c3.r, c4.r, j, i, x, y);
                        const g = lerp2D(c1.g, c2.g, c3.g, c4.g, j, i, x, y);
                        const b = lerp2D(c1.b, c2.b, c3.b, c4.b, j, i, x, y);

                        const hex = "#" + 
                            r.toString(16).padStart(2, '0') +
                            g.toString(16).padStart(2, '0') +
                            b.toString(16).padStart(2, '0');

                        w.className = "box";
                        w.style.display = "inline-block";
                        w.style.backgroundColor = hex;
                        w.style.width = (80 / x) + "vw";
                        w.style.height = (80 / x) + "vw";
                        w.style.borderRadius = (12 / x) + "vw";
                        
                        qw.appendChild(w);
                    }
                    qw.appendChild(document.createElement("br"));
                }
            }
            function getRGB(hex) {
                return {
                    r: parseInt(hex.substr(1, 2), 16),
                    g: parseInt(hex.substr(3, 2), 16),
                    b: parseInt(hex.substr(5, 2), 16)
                };
            }
            function lerp2D(v1, v2, v3, v4, j, i, x, y) {
                const s1 = v1 * v1;
                const s2 = v2 * v2;
                const s3 = v3 * v3;
                const s4 = v4 * v4;

                const u = j / (x - 1);
                const v = i / (y - 1);

                // 雙線性插值公式: 
                // TopRow = s1 + u * (s2 - s1)
                // BottomRow = s3 + u * (s4 - s3)
                // Result = TopRow + v * (BottomRow - TopRow)
                const top = s1 + u * (s2 - s1);
                const bottom = s3 + u * (s4 - s3);
                const res = top + v * (bottom - top);

                return Math.round(Math.sqrt(Math.max(0, res)));
            }
        </script>
    </body>
</html>